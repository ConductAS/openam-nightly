define("org/forgerock/openam/ui/user/login/RESTLoginHelper",["org/forgerock/openam/ui/user/delegates/AuthNDelegate","UserDelegate","org/forgerock/commons/ui/common/main/ViewManager","org/forgerock/commons/ui/common/main/AbstractConfigurationAware","org/forgerock/commons/ui/common/main/Router","org/forgerock/commons/ui/common/main/Configuration","org/forgerock/commons/ui/common/util/UIUtils","org/forgerock/commons/ui/common/util/Constants","org/forgerock/openam/ui/user/delegates/SessionDelegate","org/forgerock/commons/ui/common/util/CookieHelper","org/forgerock/openam/ui/common/util/RealmHelper"],function(e,t,n,r,i,s,o,u,a,f,l){var c=new r;return c.login=function(t,r,i){var o=this;e.getRequirements().done(function(u){var a=_.clone(u);t.userName&&t.password&&u.stage==="DataStore1"?(a.callbacks[0].input[0].value=t.userName,a.callbacks[1].input[0].value=t.password):_.each(u.callbacks,function(e,n){t.hasOwnProperty("callback_"+n)&&(a.callbacks[n].input[0].value=t["callback_"+n])}),e.submitRequirements(a).then(function(t){if(t.hasOwnProperty("tokenId"))c.getLoggedUser(function(n){s.setProperty("loggedUser",n),o.setSuccessURL(t.tokenId).then(function(){r(n),e.resetProcess()})},i);else if(t.hasOwnProperty("authId"))if(n.currentView==="LoginView")n.refresh();else{var u="#login",a=s.globalData.auth.subRealm;a&&(u+="/"+a),location.href=u}},function(e,t){e>1&&n.refresh(),i(t)})})},c.getLoggedUser=function(e,n){try{t.getProfile(function(r){s.globalData.auth.subRealm=r.userid.realm.slice(1),i.configuration.routes.login.defaults[0]=r.userid.realm,t.getUserById(r.userid.id,r.userid.realm,e,function(e){e.responseJSON.code===404?n("loggedIn"):n()},{"Not Found":{status:"404"}})},function(){c.removeSessionCookie(),n()},{serverError:{status:"503"},unauthorized:{status:"401"}})}catch(r){console.log(r),n()}},c.getLoginUrlParams=function(){var e=s.globalData.auth.fullLoginURL;return o.convertQueryParametersToJSON(e.substring(e.indexOf("?")+1))},c.setSuccessURL=function(t){var n=$.Deferred(),r=o.convertCurrentUrlToJSON().params,i=s.globalData.auth.successURL,a="";if(r&&r.goto)e.setGoToUrl(t,r.goto).then(function(e){e.successURL.startsWith("/")&&!e.successURL.startsWith("/"+u.context)&&(a="/"+u.context),s.globalData.auth.urlParams.goto=a+e.successURL,n.resolve()},function(){n.reject()});else{if(i!==u.CONSOLE_PATH||_.contains(_.map(u.CONSOLE_USERS,function(e){return e.toLowerCase()}),s.loggedUser.username.toLowerCase()))s.globalData.auth.urlParams||(s.globalData.auth.urlParams={}),s.globalData.auth.urlParams.goto||(s.globalData.auth.urlParams.goto=i);n.resolve()}return n},c.filterUrlParams=function(e){var t=["arg","authIndexType","authIndexValue","goto","gotoOnFail","ForceAuth","locale"],n={};return _.each(t,function(t){e[t]&&(n[t]=e[t])}),$.isEmptyObject(n)?"":"&"+$.param(n)},c.logout=function(e,t){var n=this,r=f.getCookie(s.globalData.auth.cookieName);a.isSessionValid(r).then(function(n){n.valid?a.logout(r).then(function(){return c.removeSessionCookie(),e(),!0},c.removeSessionCookie):(c.removeSessionCookie(),t&&t())},function(){t&&t()})},c.removeSession=function(){var e=f.getCookie(s.globalData.auth.cookieName);a.isSessionValid(e).then(function(t){t.valid&&a.logout(e).then(function(){c.removeSessionCookie()})})},c.removeSessionCookie=function(){_.each(s.globalData.auth.cookieDomains,function(e){f.deleteCookie(s.globalData.auth.cookieName,"/",e)})},c})