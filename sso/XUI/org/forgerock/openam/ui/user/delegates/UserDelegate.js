define("UserDelegate",["org/forgerock/commons/ui/common/util/Constants","org/forgerock/commons/ui/common/main/AbstractDelegate","org/forgerock/commons/ui/common/main/Configuration","org/forgerock/commons/ui/common/main/EventManager","org/forgerock/commons/ui/common/util/CookieHelper","org/forgerock/commons/ui/common/util/Mime","org/forgerock/openam/ui/common/util/RealmHelper"],function(e,t,n,r,i,s,o){var u=new t(e.host+"/"+e.context+"/json/");return u.getUserResourceName=function(e){return e.resourceName},u.getUserById=function(e,t,n,r,i){var s=o.decorateURIWithRealm("__subrealm__/users/"+e);u.serviceCall({url:s,type:"GET",headers:{"Cache-Control":"no-cache","Accept-API-Version":"protocol=1.0,resource=2.0"},success:function(e){var t={},r=0;for(r in e)_.isArray(e[r])?t[r]=e[r].join(","):t[r]=e[r];t.roles?t.roles+=",ui-user":t.roles="ui-user",t.resourceName=s,n(t)},error:r,errorsHandlers:i})},u.getProfile=function(e,t,r){var i=o.decorateURIWithRealm("__subrealm__/users?_action=idFromSession");u.serviceCall({url:i,data:"{}",type:"POST",headers:{"Accept-API-Version":"protocol=1.0,resource=2.0"},success:function(t){n.globalData.auth.successURL=t.successURL,n.globalData.auth.fullLoginURL=t.fullLoginURL,e({userid:{id:t.id,realm:t.realm},username:t.dn})},error:t,errorsHandlers:r})},u.updateUser=function(t,n,r,i){var o={"Accept-API-Version":"protocol=1.0,resource=2.0"},u=_.pick(n,["givenName","sn","mail","postalAddress","telephoneNumber"]);n._rev?o["If-Match"]='"'+n._rev+'"':o["If-Match"]='"*"',n.currentpassword&&(o[e.OPENAM_HEADER_PARAM_CUR_PASSWORD]=s.encodeHeader(n.currentpassword)),this.serviceCall({url:this.getUserResourceName(t),type:"PUT",success:r,error:i,data:JSON.stringify(u,function(e,t){return t===""?[]:t}),headers:o,errorsHandlers:{error:{status:"400"}}})},u.changePassword=function(e,t,n,r,i){var s=this.getUserResourceName(e);return s+=s.indexOf("?")===-1?"?":"&",s+="_action=changePassword",this.serviceCall({url:s,data:JSON.stringify(t),headers:{"Accept-API-Version":"protocol=1.0,resource=2.0"},type:"POST",success:n,error:r,errorsHandlers:i})},u.doAction=function(e,t,n,r,i){return u.serviceCall({url:o.decorateURIWithRealm("__subrealm__/users?_action="+e),headers:{"Accept-API-Version":"protocol=1.0,resource=2.0"},data:JSON.stringify(t),type:"POST",success:function(e){n(e)},error:r,errorsHandlers:i})},u})