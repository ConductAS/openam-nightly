define("ThemeManager",["org/forgerock/openam/ui/common/util/Constants","org/forgerock/commons/ui/common/main/Configuration"],function(e,t){var n={},r,i;return n.loadThemeCSS=function(t){return r===undefined&&($("head").find("link[href*=less]").remove(),$("head").find("link[href*=favicon]").remove(),$("<link/>",{rel:"stylesheet/less",type:"text/css",href:require.toUrl(t.path+"css/styles.less")}).appendTo("head"),$("<link/>",{rel:"icon",type:"image/x-icon",href:require.toUrl(t.path+t.icon)}).appendTo("head"),$("<link/>",{rel:"shortcut icon",type:"image/x-icon",href:require.toUrl(t.path+t.icon)}).appendTo("head"),r=$.ajax({url:require.toUrl(e.LESS_VERSION),dataType:"script",cache:!0,error:function(e,t,n){console.log(e.responseText)}})),r},n.loadThemeConfig=function(){return i===undefined&&(i=$.getJSON(require.toUrl(e.THEME_CONFIG_PATH))),i},n.getTheme=function(){var e={},r={},i=typeof t.globalData.auth.subRealm!="undefined",s,o,u;return t.globalData.theme&&n.mapRealmToTheme()===t.globalData.theme.name?(o=$.Deferred(),o.resolve(t.globalData.theme),o):n.loadThemeConfig().then(function(o){return n.data=o,t.globalData.themeConfig=o,s=n.mapRealmToTheme(),e=_.reject(n.data.themes,function(e){return e.name!==s})[0],e.name!=="default"&&e.path===""&&(u=_.reject(n.data.themes,function(e){return e.name!=="default"})[0],e=$.extend(!0,{},u,e)),i?n.loadThemeCSS(e).then(function(){return _.each(e.settings.lessVars,function(e,t){r["@"+t]=e}),less.modifyVars(r),t.globalData.theme=e,e}):n.getTheme()})},n.mapRealmToTheme=function(){var e,r="default";return t.globalData.auth.subRealm&&t.globalData.auth.subRealm.substring(1).length!==0?e=t.globalData.auth.subRealm.substring(1):e=document.domain,_.each(n.data.themes,function(t){_.each(t.realms,function(n){if(t.regex){var i=new RegExp(n);if(i.test(e))return r=t.name,!1}else if(n===e)return r=t.name,!1})}),r},n})